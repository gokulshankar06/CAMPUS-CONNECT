<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Abstracts Â· CampusConnect</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <link href="{{ url_for('static', filename='futuristic-violet.css') }}" rel="stylesheet">
  <style>
    /* Page-Specific Submissions Styles */
    body {
      min-height: 100vh;
      position: relative;
    }

    /* Submissions data flow background pattern */
    body::after {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-image: 
        radial-gradient(circle at 20% 30%, rgba(255, 0, 191, 0.2) 0%, transparent 40%),
        radial-gradient(circle at 80% 70%, rgba(255, 0, 255, 0.15) 0%, transparent 45%),
        radial-gradient(circle at 50% 50%, rgba(139, 44, 247, 0.1) 0%, transparent 50%);
      animation: submissions-pulse 20s ease-in-out infinite;
      pointer-events: none;
      z-index: 0;
    }

    @keyframes submissions-pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.8; transform: scale(1.05); }
    }

    .header { 
      background: linear-gradient(135deg, rgba(255, 0, 191, 0.15), rgba(255, 0, 255, 0.2));
      backdrop-filter: blur(20px);
      border-bottom: 1px solid rgba(255, 0, 191, 0.3);
      padding: 2rem;
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5), 0 0 80px rgba(255, 0, 191, 0.1);
      text-align: center;
    }
    
    .header-title { 
      font-size: 2.5rem; 
      font-weight: 800; 
      margin: 0 0 1.5rem 0;
      font-family: 'Poppins', sans-serif;
      text-transform: uppercase;
      letter-spacing: 2px;
      background: linear-gradient(135deg, #ff00bf, #ff00ff, #8b2cf7);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-shadow: 0 0 50px rgba(255, 0, 191, 0.5);
    }
    
    .nav { 
      display: flex; 
      justify-content: center; 
      gap: 1.5rem; 
      flex-wrap: wrap; 
    }
    
    .nav a { 
      text-decoration: none; 
      color: #e9d5ff; 
      font-weight: 600; 
      font-size: 0.875rem; 
      padding: 0.75rem 1.5rem; 
      border-radius: 24px; 
      border: 1px solid rgba(255, 0, 191, 0.3); 
      background: rgba(255, 0, 191, 0.1);
      text-transform: uppercase;
      letter-spacing: 1px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }

    .nav a::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      background: radial-gradient(circle, rgba(255, 0, 191, 0.4), transparent);
      transform: translate(-50%, -50%);
      transition: width 0.5s ease, height 0.5s ease;
    }

    .nav a:hover::before {
      width: 150%;
      height: 150%;
    }
    
    .nav a:hover { 
      color: #ff00bf;
      border-color: #ff00bf;
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(255, 0, 191, 0.4);
      text-shadow: 0 0 10px rgba(255, 0, 191, 0.8);
    }

    .container { 
      max-width: 1200px; 
      margin: 3rem auto; 
      padding: 0 2rem; 
      position: relative;
      z-index: 10;
    }

    .card {
      background: linear-gradient(145deg, rgba(255, 0, 191, 0.05), rgba(29, 0, 82, 0.85));
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 0, 191, 0.2);
      border-radius: 32px;
      padding: 2.5rem;
      box-shadow: 
        0 25px 60px rgba(0, 0, 0, 0.4),
        0 0 100px rgba(255, 0, 191, 0.1),
        inset 0 0 60px rgba(255, 0, 191, 0.05);
      animation: fadeInUp 0.6s ease-out;
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .surface { 
      background: linear-gradient(145deg, rgba(255, 0, 191, 0.1), rgba(29, 0, 82, 0.9));
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 0, 191, 0.3);
      border-radius: 16px;
      padding: 1.5rem;
      margin-bottom: 1rem;
    }
    
    .muted { 
      color: #a78bfa; 
    }
    
    .divider { 
      border-top: 1px solid rgba(255, 0, 191, 0.3); 
    }
  </style>
</head>
<body>
  <header class="header" role="banner">
    <h1 class="header-title"><i class="fas fa-file-upload"></i> Abstracts for "{{ assignment.title }}"</h1>
    <nav class="nav" role="navigation" aria-label="Primary">
      <a href="{{ url_for('faculty.faculty_assignments') }}"><i class="fas fa-calendar-alt"></i> Back to My Events</a>
      <a href="{{ url_for('auth.logout') }}"><i class="fas fa-sign-out-alt"></i> Logout</a>
    </nav>
  </header>

  <main class="container" role="main" style="max-width: 1200px; margin: 2rem auto; padding: 0 1.5rem;">
    <div class="card" style="background: rgba(20, 10, 50, 0.6); border-radius: 12px; padding: 2rem; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3); backdrop-filter: blur(10px); border: 1px solid rgba(255, 0, 191, 0.2);">
      <h2 class="text-center" style="font-size: 1.75rem; font-weight: 700; color: #fff; margin: 0 0 2rem 0; position: relative; display: inline-block; width: 100%; text-align: center;">
        <i class="fas fa-file-upload" style="margin-right: 0.75rem; color: #ff00ff;"></i>Submitted Abstracts
      </h2>

      <form method="GET" style="max-width: 800px; margin: 0 auto 2rem; display: flex; gap: 0.75rem; align-items: center;">
        <input type="hidden" name="page" value="1" />
        <input 
          name="q" 
          value="{{ q or '' }}" 
          placeholder="Search by student or content..." 
          style="flex: 1; padding: 0.75rem 1rem; border-radius: 8px; border: 1px solid rgba(255, 0, 191, 0.3); background: rgba(10, 0, 30, 0.6); color: #fff; font-size: 1rem; transition: all 0.3s ease;"
          onfocus="this.style.borderColor='#ff00ff'; this.style.boxShadow='0 0 0 2px rgba(255, 0, 191, 0.2)';"
          onblur="this.style.borderColor='rgba(255, 0, 191, 0.3)'; this.style.boxShadow='none';"
        />
        <button 
          type="submit" 
          style="background: linear-gradient(135deg, #ff00ff, #8b2cf7); color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; gap: 0.5rem;"
          onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 15px rgba(255, 0, 191, 0.4)';"
          onmouseout="this.style.transform='none'; this.style.boxShadow='none';"
        >
          <i class="fas fa-search"></i> Search
        </button>
        {% if q %}
          <a 
            href="{{ url_for('faculty.view_submissions', assignment_id=assignment.id) }}" 
            style="color: #b8c1ec; text-decoration: none; padding: 0.5rem 1rem; border-radius: 6px; transition: all 0.2s ease;"
            onmouseover="this.style.background='rgba(255, 255, 255, 0.05)';"
            onmouseout="this.style.background='transparent';"
          >
            Clear
          </a>
        {% endif %}
      </form>

      <div style="margin-top: 1.5rem;">
        {% if not submissions_with_reports %}
          <div style="text-align: center; padding: 3rem 2rem; background: rgba(20, 10, 50, 0.4); border-radius: 12px; border: 1px dashed rgba(255, 0, 191, 0.3);">
            <i class="fas fa-inbox" style="font-size: 3rem; margin-bottom: 1rem; color: #b8c1ec; display: block; opacity: 0.7;"></i>
            <p style="color: #b8c1ec; font-size: 1.1rem; margin: 0; line-height: 1.6;">
              No abstracts have been submitted for this event yet.
            </p>
          </div>
        {% else %}
          {% for sub_report in submissions_with_reports %}
            <div class="submission-card" style="background: rgba(29, 0, 82, 0.4); border-radius: 12px; padding: 1.5rem; margin-bottom: 1.5rem; border: 1px solid rgba(255, 0, 191, 0.15); transition: all 0.3s ease; position: relative; overflow: hidden;">
              <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1rem; flex-wrap: wrap; gap: 1rem;">
                <h3 style="font-size: 1.25rem; font-weight: 600; margin: 0; color: #fff; line-height: 1.4;">
                  <i class="fas fa-user-graduate" style="margin-right: 0.5rem; color: #ff00ff;"></i>{{ sub_report.submission.username }}
                </h3>
                <div style="display: flex; gap: 0.75rem; flex-wrap: wrap;">
                  {% if sub_report.submission.grade is not none %}
                    <span style="background: rgba(0, 215, 150, 0.15); color: #00d796; font-size: 0.875rem; font-weight: 600; padding: 0.35rem 0.75rem; border-radius: 20px; display: inline-flex; align-items: center; border: 1px solid rgba(0, 215, 150, 0.3);">
                      <i class="fas fa-star" style="margin-right: 0.35rem;"></i> Grade: {{ sub_report.submission.grade }}/100
                    </span>
                  {% else %}
                    <span style="background: rgba(255, 180, 0, 0.15); color: #ffb400; font-size: 0.875rem; font-weight: 600; padding: 0.35rem 0.75rem; border-radius: 20px; display: inline-flex; align-items: center; border: 1px solid rgba(255, 180, 0, 0.3);">
                      <i class="fas fa-clock" style="margin-right: 0.35rem;"></i> Not graded
                    </span>
                  {% endif %}
                </div>
              </div>
              
              <div style="background: rgba(10, 0, 30, 0.4); border-radius: 8px; padding: 1rem; margin: 1rem 0; border-left: 3px solid #8b2cf7;">
                <p style="margin: 0; color: #b8c1ec; font-size: 0.95rem; line-height: 1.6;">
                  {{ (sub_report.submission.content[:300] ~ ('...' if sub_report.submission.content|length > 300 else '')) if sub_report.submission.content else 'No content provided.' }}
                </p>
              </div>
              <div style="display: flex; flex-wrap: wrap; gap: 0.75rem; margin-top: 1.25rem; padding-top: 1.25rem; border-top: 1px dashed rgba(255, 0, 191, 0.2);">
                <a 
                  href="{{ url_for('faculty.submission_detail', submission_id=sub_report.submission.id) }}" 
                  style="background: linear-gradient(135deg, #8b2cf7, #6b00d4); color: white; text-decoration: none; padding: 0.6rem 1.25rem; border-radius: 8px; font-weight: 500; font-size: 0.9rem; display: inline-flex; align-items: center; gap: 0.5rem; transition: all 0.2s ease;"
                  onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(139, 44, 247, 0.3)';"
                  onmouseout="this.style.transform='none'; this.style.boxShadow='none';"
                >
                  <i class="fas fa-arrow-right"></i> View & Grade
                </a>
                
                {% if sub_report.submission.file_name %}
                  <a 
                    href="{{ url_for('faculty.view_submission_file', submission_id=sub_report.submission.id) }}" 
                    style="background: rgba(0, 191, 255, 0.1); color: #00bfff; text-decoration: none; padding: 0.6rem 1.25rem; border-radius: 8px; font-weight: 500; font-size: 0.9rem; display: inline-flex; align-items: center; gap: 0.5rem; border: 1px solid rgba(0, 191, 255, 0.2); transition: all 0.2s ease;"
                    onmouseover="this.style.background='rgba(0, 191, 255, 0.2)'; this.style.transform='translateY(-2px)';"
                    onmouseout="this.style.background='rgba(0, 191, 255, 0.1)'; this.style.transform='none';"
                  >
                    <i class="fas fa-file-alt"></i> View File
                  </a>
                  
                  <a 
                    href="{{ url_for('faculty.download_submission', submission_id=sub_report.submission.id) }}" 
                    style="background: rgba(0, 215, 150, 0.1); color: #00d796; text-decoration: none; padding: 0.6rem 1.25rem; border-radius: 8px; font-weight: 500; font-size: 0.9rem; display: inline-flex; align-items: center; gap: 0.5rem; border: 1px solid rgba(0, 215, 150, 0.2); transition: all 0.2s ease;"
                    onmouseover="this.style.background='rgba(0, 215, 150, 0.2)'; this.style.transform='translateY(-2px)';"
                    onmouseout="this.style.background='rgba(0, 215, 150, 0.1)'; this.style.transform='none';"
                  >
                    <i class="fas fa-download"></i> Download
                  </a>
                {% else %}
                  <a 
                    href="{{ url_for('faculty.download_submission', submission_id=sub_report.submission.id) }}" 
                    style="background: rgba(0, 191, 255, 0.1); color: #00bfff; text-decoration: none; padding: 0.6rem 1.25rem; border-radius: 8px; font-weight: 500; font-size: 0.9rem; display: inline-flex; align-items: center; gap: 0.5rem; border: 1px solid rgba(0, 191, 255, 0.2); transition: all 0.2s ease;"
                    onmouseover="this.style.background='rgba(0, 191, 255, 0.2)'; this.style.transform='translateY(-2px)';"
                    onmouseout="this.style.background='rgba(0, 191, 255, 0.1)'; this.style.transform='none';"
                  >
                    <i class="fas fa-download"></i> Download (.txt)
                  </a>
                {% endif %}
              </div>

              {% if sub_report.overall_similarity is defined %}
                <div style="margin-top: 1.5rem; padding-top: 1.25rem; border-top: 1px dashed rgba(255, 0, 191, 0.2);">
                  <h4 style="font-size: 1rem; font-weight: 600; color: #fff; margin: 0 0 0.75rem 0; display: flex; align-items: center; gap: 0.5rem;">
                    <i class="fas fa-search-plus" style="color: #ff00ff;"></i> Plagiarism Analysis
                  </h4>
                  <div style="margin-top: 0.5rem; padding: 1rem; border-radius: 8px;
                    {% if sub_report.overall_similarity > 60 %} 
                      background: rgba(255, 59, 48, 0.1); border-left: 3px solid #ff3b30;
                    {% elif sub_report.overall_similarity > 20 %} 
                      background: rgba(255, 180, 0, 0.1); border-left: 3px solid #ffb400;
                    {% else %} 
                      background: rgba(0, 215, 150, 0.1); border-left: 3px solid #00d796;
                    {% endif %}">
                    
                    <div style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 0.5rem; margin-bottom: 0.75rem;">
                      <span style="font-weight: 600; color: #fff;">Overall Similarity:</span>
                      <span style="
                        font-weight: 700; 
                        {% if sub_report.overall_similarity > 60 %}
                          color: #ff6b6b;
                        {% elif sub_report.overall_similarity > 20 %}
                          color: #ffd166;
                        {% else %}
                          color: #06d6a0;
                        {% endif %}
                      ">
                        {{ sub_report.overall_similarity|round(1) }}%
                      </span>
                    </div>
                    
                    {% if sub_report.plagiarism_report %}
                      <div style="margin-top: 0.75rem;">
                        <p style="font-size: 0.875rem; color: #b8c1ec; margin: 0 0 0.5rem 0;">
                          <i class="fas fa-exclamation-triangle" style="margin-right: 0.5rem; color: #ffb400;"></i>
                          Potential matches found:
                        </p>
                        <ul style="list-style-type: none; margin: 0; padding: 0; font-size: 0.85rem;">
                          {% for item in sub_report.plagiarism_report %}
                            <li style="padding: 0.5rem 0; border-bottom: 1px solid rgba(255, 255, 255, 0.05); display: flex; justify-content: space-between; align-items: center;">
                              <span style="color: #b8c1ec;">
                                <i class="fas fa-user-graduate" style="margin-right: 0.5rem; color: #ff6b6b;"></i>
                                {{ item.source_user }}
                              </span>
                              <span style="font-weight: 600; color: #ff6b6b;">{{ item.similarity }}% match</span>
                            </li>
                          {% endfor %}
                        </ul>
                      </div>
                    {% else %}
                      <p style="font-size: 0.9rem; color: #b8c1ec; margin: 0.5rem 0 0 0; display: flex; align-items: center; gap: 0.5rem;">
                        <i class="fas fa-check-circle" style="color: #06d6a0;"></i>
                        No significant similarity found with other submissions.
                      </p>
                    {% endif %}
                  </div>
                </div>
              {% endif %}
              </div>
          {% endfor %}
        {% endif %}
      </div>
    </div>

    {% if total_pages and total_pages > 1 %}
      <div style="margin-top: 2.5rem; background: rgba(20, 10, 50, 0.6); border-radius: 12px; padding: 1.5rem; border: 1px solid rgba(255, 0, 191, 0.15);">
        <nav style="display: flex; align-items: center; justify-content: center; gap: 0.5rem; flex-wrap: wrap;" aria-label="Pagination">
          {% set prev_page = page - 1 %}
          {% set next_page = page + 1 %}
          
          <!-- Previous Button -->
          <a 
            href="{{ url_for('faculty.view_submissions', assignment_id=assignment.id, page=prev_page, q=q) }}"
            style="
              padding: 0.5rem 1rem;
              border-radius: 8px;
              border: 1px solid rgba(255, 0, 191, 0.3);
              color: #e9d5ff;
              text-decoration: none;
              transition: all 0.2s ease;
              {% if page <= 1 %}
                opacity: 0.5;
                pointer-events: none;
              {% else %}
                background: rgba(255, 0, 191, 0.1);
              {% endif %}
            "
            onmouseover="if({{ page > 1 }}) { this.style.background='rgba(255, 0, 191, 0.2)'; this.style.borderColor='rgba(255, 0, 191, 0.5)'; this.style.transform='translateY(-2px)'; }"
            onmouseout="if({{ page > 1 }}) { this.style.background='rgba(255, 0, 191, 0.1)'; this.style.borderColor='rgba(255, 0, 191, 0.3)'; this.style.transform='none'; }"
          >
            <i class="fas fa-chevron-left"></i> Previous
          </a>
          
          <!-- Page Numbers -->
          {% for p in range(1, total_pages + 1) %}
            <a 
              href="{{ url_for('faculty.view_submissions', assignment_id=assignment.id, page=p, q=q) }}"
              style="
                width: 2.5rem;
                height: 2.5rem;
                display: flex;
                align-items: center;
                justify-content: center;
                border-radius: 8px;
                text-decoration: none;
                font-weight: 500;
                transition: all 0.2s ease;
                {% if p == page %}
                  background: linear-gradient(135deg, #ff00ff, #8b2cf7);
                  color: white;
                  border: none;
                {% else %}
                  border: 1px solid rgba(255, 0, 191, 0.3);
                  color: #b8c1ec;
                {% endif %}
              "
              onmouseover="if({{ p != page }}) { this.style.background='rgba(255, 0, 191, 0.2)'; this.style.borderColor='rgba(255, 0, 191, 0.5)'; this.style.transform='translateY(-2px)'; }"
              onmouseout="if({{ p != page }}) { this.style.background='transparent'; this.style.borderColor='rgba(255, 0, 191, 0.3)'; this.style.transform='none'; }"
            >
              {{ p }}
            </a>
          {% endfor %}
          
          <!-- Next Button -->
          <a 
            href="{{ url_for('faculty.view_submissions', assignment_id=assignment.id, page=next_page, q=q) }}"
            style="
              padding: 0.5rem 1rem;
              border-radius: 8px;
              border: 1px solid rgba(255, 0, 191, 0.3);
              color: #e9d5ff;
              text-decoration: none;
              transition: all 0.2s ease;
              {% if page >= total_pages %}
                opacity: 0.5;
                pointer-events: none;
              {% else %}
                background: rgba(255, 0, 191, 0.1);
              {% endif %}
            "
            onmouseover="if({{ page < total_pages }}) { this.style.background='rgba(255, 0, 191, 0.2)'; this.style.borderColor='rgba(255, 0, 191, 0.5)'; this.style.transform='translateY(-2px)'; }"
            onmouseout="if({{ page < total_pages }}) { this.style.background='rgba(255, 0, 191, 0.1)'; this.style.borderColor='rgba(255, 0, 191, 0.3)'; this.style.transform='none'; }"
          >
            Next <i class="fas fa-chevron-right"></i>
          </a>
        </nav>
      </div>
    {% endif %}
  </main>
</body>
</html>
